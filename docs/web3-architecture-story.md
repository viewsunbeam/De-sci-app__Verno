# Verno Web3 架构与竞赛叙事

> 面向 CCF 第四届大学生区块链技术与创新应用竞赛评审与团队成员，阐述 Verno 平台的设计动机、取舍与价值。

---

## 1. 传统科研协同的痛点

| 问题 | 传统做法 | 造成的困境 |
| --- | --- | --- |
| 数据确权与溯源 | 文件系统 / 云盘共享 | 难以验证原始提交时间、易被篡改 |
| 评审流程不透明 | 邮件/表单评审 | 重复劳动、不公平、难追责 |
| 激励分配模糊 | 论文署名 / 线下奖励 | 贡献难量化，激励缺乏实时反馈 |
| 隐私与共享矛盾 | 完全公开或拒绝共享 | 无法实现“可验证、可控访问”的资料交换 |

我们希望通过 Web3 打造一个“可信科研”的叙事：**科研活动可验证、贡献可量化、隐私可控、激励可落地**。

---

## 2. 我们的设计原则

1. **链上可信**：身份、数据指纹、科研成果的关键事实上链，确保不可篡改与可审计。
2. **链下高效**：大体量文件、复杂计算留在链下，通过事件驱动与哈希校验保持一致性。
3. **可插拔的治理与激励**：利用智能合约提供可组合的评审、积分与奖励模块。
4. **渐进式演进**：保留传统科研工作流程的惯性（账号体系、REST 接口），逐步导入 Web3 组件。

---

## 3. 架构概览

```
┌────────────────────┐        ┌───────────────────────┐
│  Vue 前端 (Vite)   │  REST  │  Node/Express + SQLite │
│  • 科研门户         │◀──────▶│  • 业务 API / 身份缓存  │
│  • 竞赛定制文案     │        │  • 文件上传 + 加密      │
└────────▲──────────┘        │  • ABI 同步 (scripts)   │
         │                     └─────────▲────────────┘
         │ WebSocket /         事件监听   │
         │ REST 订阅          ┌───────────┴───────────┐
         │                    │ Go 链下服务 (chain-api)│
         │                    │ • 订阅合约事件           │
         │                    │ • 写入 research_data 等 │
         │                    │ • 链下查询缓存           │
         │                    └───────────▲───────────┘
         │                                 │
         │            合约调用 / 事件      │
         │                             ┌───┴────────────┐
         ▼                             │ Hardhat 本地区块链 │
┌────────────────────┐              │ • DeSciPlatform 等 │
│ 智能合约 (Solidity) │              │ • NFT/评审/身份     │
│ • DeSciRegistry     │              └──────────────────┘
│ • DatasetManager    │
│ • ResearchNFT       │
│ • InfluenceRanking  │
└────────────────────┘
```

- **智能合约层**：负责身份注册（DID）、数据集/成果哈希登记、NFT 铸造、影响力积分等核心逻辑。
- **链下服务（Go）**：监听合约事件，将链上事实写入 SQLite 并对外提供高性能查询、哈希校验。
- **Node/Express API**：处理账号、协作、文件上传、评审等传统业务，必要信息同步链上。
- **前端（Vue）**：面向竞赛场景的用户界面，展示数据链路、影响力榜单与 Demo 指引。

---

## 4. 链上 vs 链下：我们如何取舍

| 模块 | 链上内容 | 链下内容 | 取舍说明 |
| --- | --- | --- | --- |
| 用户 / DID | 注册事件、角色权限 | 档案信息、邮箱、兴趣标签 | 链下保存更易调整，链上保证身份可信 |
| 数据集 | 哈希、隐私类型、ZK 证明索引 | 原始文件、加密密钥 | 大文件不上链，组合 IPFS/加密访问更高效 |
| 科研成果 | NFT 铸造、作者份额 | PDF 存储、评审反馈 | NFT 确权 + 链下细节更兼顾体验 |
| 评审与影响力 | 事件触发、权重参数 | 评分计算、排名缓存 | 先链下聚合，后续计划写回 `InfluenceRanking` |
| 激励结算 | 可扩展的奖励分发接口 | 当前手动触发 | 预留 `bonus`、`governance` 类合约函数，演示流程 |

---

## 5. 监听与验证：链上写、链下读的闭环

1. **上传数据集**：用户通过 API 上传文件 → Node 记录元数据 → DatasetManager 存储哈希 → Go 服务监听 `DatasetUploaded` 把信息同步至 SQLite → `/api/chain/dataset/:id` 提供验证。
2. **科研成果 NFT**：提交论文 → Node 存 PDF → 调用 `ResearchNFT.mintResearch` → 事件 `ResearchMinted` → Go 服务写入 `research_data` → 前端/REST 显示最新成果并校验哈希。
3. **影响力计算**：每个链上事件都会写日志 → 链下定时拉取，按权重聚合生成排名 → 前端渲染 “竞赛影响力榜单”，评委可调用 `/api/chain/research/by-author/:address` 二次验证。

---

## 6. 仍在演进的部分

- **评审奖励上链**：目前评分结果存于链下，下一阶段计划将积分写回合约，支持自动发放 ERC20 奖励。
- **数据加密托管**：现阶段密钥策略为链下记录，后续扩展为基于多方计算或门限加密的链上权限管理。
- **多链部署**：当前使用 Hardhat 本地链，方案已兼容 L2 / 公链部署，通过 `deployEnhancedDeSci.js` 一键部署。

---

## 7. 竞赛叙事摘要

1. **问题**：传统科研协同在确权、评审、激励与隐私之间难以兼顾。
2. **解决方案**：Verno 将科研流程拆分为“链上可信记录 + 链下高效处理”，利用智能合约保证事实、用链下服务承载高吞吐查询。
3. **价值**：评委与用户可以“看得见”的方式验证：谁在何时提交了什么数据、评审如何评分、奖励如何分配——实现可信科研生态雏形。

欢迎结合 `docs/demo-api-playbook.md` 的 API 流程演示，以事件日志与哈希校验佐证 Verno 在 Web3 语境下的创新点。同行评议的透明度、数据隐私的可控性以及激励机制的量化呈现，是我们参赛故事的核心。
